<template>
	<div class="test">
		<div class="content">
			<div class="movie" v-if="movieData != null">
				<img :src="basicImgSrc + movieData.poster_path">
				<h1><span>{{movieData.title}}</span><rate :name="movieData.id" :value="movieData.vote_average/2" :radius="60" :offset="5"></rate></h1>
				<p><strong>overviews</strong>:{{movieData.overview}}</p>
				
				<point :radius="30" :movieId="movieData.id" @rating="rating"></point>	
			</div>
			<div class="load" v-else>
				<img src="../assets/loading.gif">
			</div>
			<div class="next" @click="next">
				<span v-if="num <= 9">Next</span>
				<span v-else>Finish</span>
				<span class="small">{{num}}/10</span>
			</div>
		</div>
	</div>
</template>

<script type="text/javascript">
	import point from '@/components/point'
	import rate from '@/components/rate'
	export default{
		components:{
			point,rate
		},
		methods:{
			getMovie(){
				if(this.arr.length == 0)
					this.$router.push({path:'/'});
				var id = Math.floor(Math.random()*this.arr.length);
				var str = this.arr.splice(id,1);
				this.axios.get('https://api.themoviedb.org/3/movie/'+str[0]+'?api_key=6e13583a127e758dac0d94b26b7068bf').
				then((res)=>{
					this.movieData = res.data;
					console.log(res);
				}).catch((err)=>{
					console.log(err);
					this.next();
				});
			},
			next(){
				if(this.num < 10)
				{
					this.movieData = null;
					this.getMovie();
				}else {
					this.$router.push({path:'/user'})
				}
			},
			rating(){
				this.num++;
			},
			checkLogin(){
				this.axios.get('checkLogin')
				.then((res)=>{
					if(res.data.status)
						this.getMovie();
					else
					{
						alert('请先登陆！');
						this.$router.push({path:'/register'})
					}
				})
				.catch((err)=>{
					console.log(err);
				});
			}
		},
		mounted(){
			this.checkLogin();
		},
		data(){
			return{
				movieData:null,
				basicImgSrc:'https://image.tmdb.org/t/p/w342',
				num:0,
				arr:["157350","6418","71622","174671","185008","69746","137968","100241","54102","157099","110414","181886","15359","44516","152760","137106","97020","209247","314040","249397","74461","120143","197082","99367","157834","137321","206822","12124","210047","249923","212721","222899","120467","225565","157336","205724","225574","53182","202141","248774","175291","82703","97370","136797","242042","177494","209403","25541","100402","209276","86834","173455","145220","208277","9753","200505","191294","180299","102382","157832","157547","244509","179538","172385","157353","59726","42697","193610","12242","254473","54752","168742","145247","210479","195589","258476","191720","205601","152599","240832","127585","124905","188166","212778","120852","40721","113833","232672","198277","253270","102651","254474","194722","188161","137113","177677","198185","248212","222935","174682","82881","110428","157851","228028","187017","156022","82702","194662","146243","85350","184098","250658","91314","169607","171372","180296","218836","226486","242224","267999","244786","210577","92323","250766","119450","250700","123109","211052","265349","253235","253310","225886","244267","238636","214075","118340","138103","184315","279414","157849","242088","209269","239566","212849","229297","253306","228194","76757","98566","227156","286709","193893","242022","211067","189","265010","221902","220289","256274","242090","241848","285597","234200","254191","154400","244772","3171","135418","198663","261855","244264","265189","157825","17200","170687","239678","267480","190859","246403","149509","286554","56386","49017","227300","244761","206487","246741","43398","239571","245891","208869","205587","244268","228150","266285","239563","289727","242512","242582","177572","49706","228326","273271","264660","116440","98622","14830","86616","289314","87492","185567","207933","260001","256092","272692","167581","205596","171274","131631","295315","237791","147441","265195","9742","100042","206821","261037","15741","114750","266856","282848","254194","110416","241771","303623","135397","293310","227159","270946","256917","294254","244458","303742","297596","207774","270005","17792","245916","158483","122917","273895","227306","277547","252171","34505","241239","228970","284296","87093","224141","243684","228967","207703","181533","68737","276908","198184","260346","201088","294652","87101","26621","149362","4226","24655","256876","270303","3539","262176","256740","76341","140607","271969","68735","99861","102899","166424","293660","271110","246655","268171","53575","47925","284276","284536","216015","81294","53285","250066","189197","272693","20875","227719","321594","167073","249688","310121","245706","319070","318224","318225","318044","283235","308638","308639","308369","308024","308027","308032","72784","54325","43513","273248","286565","252838","241251","311291","311301","320007","21585","170750","42590","325358","179150","256591","246127","268238","13643","220620","290764","228203","239573","241554","150689","228968","238215","70027","243688","266647","252512","262500","228161","20377","245703","275060","244063","168259","228973","256030","39041","13015","137221","257091","254578","299551","308504","321640","304357","269148","158852","250665","229182","256961","278990","295592","313074","293863","319389","256924","325113","309304","192712","254128","284537","300302","31524","250734","249070","275601","314407","306482","301728","254470","258099","258480","254320","287424","268920","94365","334130","286217","333381","251516","334074","238713","271718","222936","245906","188222","150540","307931","271714","131634","257344","34766","29742","34765","328111","343921","238615","274854","297761","47933","188927","214756","211672","105864","261023","206647","331446","34509","34513","14092","321697","196257","296099","250574","254024","239568","240483","309887","209112","331781","102016","264999","278927","203801","287689","285783","308077","301748","299245","54155","284362","259679","62931","281957","282984","81549","307081","273481","319067","291270","253344","257211","318033","264644","277546","328425","25161","310131","298312","261392","277216","310133","41423","41636","19654","19828","40205","23427","32633","146778","77583","19369","36041","29063","185768","308084","60850","274479","37091","245168","323272","276907","323373","306819","313922","5900","283587","345468","294086","65014","81704","319076","296100","253412","314365","245698","295964","159824","301228","330112","285689","296098","316042","244316","306947","270487","334536","257445","304372","294963","298382","45147","342786","321741","227973","315465","44282","254005","306952","312221","324325","339527","332534","193544","92326","265351","323679","295748","364067","333555","300693","318846","347969","303867","329833","259694","274167","266294","140300","372981","24426","344041","362045","256687","58431","325173","370646","374454","373355","321258","296096","372315","316000","333371","267860","269149","267193","92060","104548","42346","301365","320588","326649","342521","387893","369557","290595","325133","376570","303858","127380","332411","353069","290250","108176","332567","290098","384798","291805","26677","308531","341012","259693","328429","43074","302699","324668","278348","258489","316727","316023","177869","353571","399106","328387","368620","401387","373348","338766","390734","314420","390989","159550","410612","392572","402672","315011","391698","137608","410803"]
			}
		}
	}
</script>

<style type="text/css" lang="less" scoped>
	.test{
		width: 100%;
		display: flex;
		justify-content: center;
		.content{
			width:1000px;
			padding:0 20px;
			display: flex;
			flex-direction: column;
			align-items: center;
			padding-top:80px;
			padding-bottom: 80px;
			.movie{
				display: flex;
				flex-direction: column;
				align-items: center;
				padding-bottom: 50px;
				h1{
					display: flex;
					align-items: center;
					>span{
						margin-right:20px;
					}
				}
			}
			.next{
				border:1px solid #d7d7d7;
				padding:10px 20px;
				border-radius: 10px;
				cursor: pointer;
				background-color:#081c24;
				color:rgba(255,255,255,0.9);
				.small{
					font-size:10px;
				}
			}
		}
	}
	@media screen and (max-width: 768px) {
		.test{
			.content{
				width:100%;
				padding:0 10px;
				box-sizing: border-box;
				padding-bottom: 30px;
				.movie{
					>img{
						width:300px;
					}
					h1{
						font-size: 20px;
					}
					p{
						font-size: 16px;
					}
				}
			}
		}
	}
</style>